language: python
python:
    - "3.7"

sudo: 'required'

deploy:
  provider: heroku
  api_key:
    secure: gVfzgkA/+S3+1Tl3Lq/yXD54tomXny+0f7xCbS4+MsM+hgytkh+0lPA+H7Flh5wmv6lxT5R//fv1S98mv1C0T5hCeQyrdWHIbINMUc/YThnqaaaIjJ54i0mtHleM/CSPMkFo3SC0NS6+ll2h+IlwAkE4WWmX/tAbskiIlG/0Mxk9mjlqXa1QqZWquXhlePaJzOlFF8XGOMZrARUAY+0QlDA0LyLQNAaYmjYX8zCYqlBBoBeERrXpCNeAwtZoizUs3z45LJX14Uznow4njU1ZhO6YvBT92FHnc+AF6V53si3tUUciUDublYj+vy6qeAZBbLTewKW5yMO4Uft1Csu5UI4zj953wQ7gSh5L5XvmshuMHodVRXXOaTuiLobVd0RGL6BVtOFW+c6z6KFMXU5g47BeF2CJHAQsNR5nlD6BreOwm88TX0XAFHgIpojoIAbYeP+lYZVqTCOjHkIFHR4cg/rzNp924kSwW5UnSdww9AG6l/eG7jYogxs6fHeG7fUIV6AR22cga3dyFmx7F2OMHGub6j9+DbhW5lIdm6tj4vpNwjvySboOaJCQeaBMQHCWZJ/c0B2js+VRI5PM0vpV9bhg2B4FGpEkAKYuOeQILPxhraEk1EoEvhqKBHw3AJgKtn5uvaW1bAOU99/uf/O/3/xjRqAPEHJMnJ+jzQYXbD4=
  app: web_poker
  on:
    repo: tom-pollak/web_poker
  skip_cleanup: 'true'

services:
    -docker

env:
    DOCKER_COMPOSE_VERSION: 1.25.5

    before_install:
        - sudo rm /usr/local/bin/docker-compose
        - curl -L https://github.com/docker/compose/releases/download/${DOCKER_COMPOSE_VERSION}/docker-compose-`uname -s`-`uname -m` > docker-compose
        - chmod +x docker-compose
        - sudo mv docker-compose /usr/local/bin

    before_script:
        - docker-compose up -d --build

    script:
        - docker-compose exec users python manage.py test
        - heroku container:push web

    after_script:
        - docker-compose down
